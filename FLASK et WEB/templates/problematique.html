{% extends 'header_layout.html' %}
{%block css%}<link rel="stylesheet" href="../static/QuestionSolution.css">{%endblock%}

{% block header %}

    <h1>{{prob[2]}}</h1>
    {% for i in range(0,len_question-incr_etat) %}

    <div class="tablo-question-solution">
        <button id="{{choosen_question[i][0]}}" class="question-button" onclick="show_hide(this.id,'{{choosen_solution[i][0]}}')">{{choosen_question[i][2]}}</button>
        <button id="{{choosen_solution[i][0]}}" class="solution-button" onclick="show_hide(this.id,'{{choosen_question[i][0]}}')">{{choosen_solution[i][2]}}</button>
    </div>

    <!--à voir si la fin du for marche-->
    <div id="{{'-'+choosen_question[i][0]}}" class="tablo-gagnants-perdants">
        <!--Le probleme de faire tout dans un tableau est ici. Pour un rang i de question et de solution, la solution gagnante et la question gagnante n'ont pas le rang i dans choosen_solution-->
        {%for j in every_question[i]%}
            {% if j[2]==choosen_question[i][2] %}
                <p class="choix-gagnant">{{j[2]}}</p> 
            {% else %}
                <p class="choix-perdant">{{j[2]}}</p>
            {% endif %}
        {%endfor%}
    </div>
    
    <div id="{{'-'+choosen_solution[i][0]}}" class="tablo-gagnants-perdants">
        {%for j in every_solution[i]%}
            {% if j[2]==choosen_solution[i][2] %}
                <p class="choix-gagnant">{{j[2]}}</p>
            {% else %}
                <p class="choix-perdant">{{j[2]}}</p>
            {% endif %}
        {%endfor%}
    </div>
   
    {% endfor %}

    
    <script>
        function show_hide(button_id,other_button_id) //cette fonction change le display css du bouton cliqué de grid à none (ça affiche ou non), si un autre grid est deja affiché elle le desactive au passage.
        {
            var Button = document.getElementById("-"+button_id);
            var OtherButton = document.getElementById("-"+other_button_id);

            if(Button.style.display === "grid")
                {
                    Button.style.display = "none";
                }
            else
                {
                    OtherButton.style.display = "none";
                    Button.style.display = "grid";
                }
        }
    </script>
  

    <div class="tablo-question-solution">
        <button class="question-button-only">{{last_question[2]}}</button> <!--il faut un moyen de savoir si on est dans un cas : vote de question ou vote de solution-->
    </div>

    <h2>{{message_vote}}</h2>

    {% if session.mail %}
        <div class="tablo-choix">
            {% for j in possible_solutions %}
                {% if j[0]==voted_solutions %}
                    <a class="choisi" href="/problematique/{{prob[0]}}?id={{j[0]}}">{{j[2]}}</a> <!--là y'a une erreur à fix-->
                {% else %}
                    <a class="choix" href="/problematique/{{prob[0]}}?id={{j[0]}}">{{j[2]}}</a>
                {% endif %}
            {%endfor%}
            {% if not(etat=="backtracking")%}
            <a class="choix" href="/problematique/ajout_prop/{{prob[0]}}/{{last_question[0]}}">+</a>
            {%endif%}
        </div>

        <a href="/problematique/{{prob[0]}}?cloture=True"><br />Cloture des votes (expérimental)</a>

    {%else %}
        <div class="tablo-choix">
            {% for j in possible_solutions%}
                <a class="choix">{{j[2]}}</a>
            {%endfor%}
        </div>

        <h2>Connecte-toi pour ajouter des solutions, envoyer des messages ou voter</h2>
    {% endif %}

    
    {% if session.mail %}
    <form class="form_new_msg" method ="POST">
        <input class="message" autocomplete="off" name="message" placeholder="Message à envoyer" type="text">
        <input class="submit" type="submit" value="Envoyer">
    </form>
    {% endif %}

    <div class="chatbox">
        {% for m in messages %}
        <p class="chat"><span class="mail">{{m[2]}}:&nbsp;</span>{{m[1]}}&nbsp;&nbsp;&nbsp;&nbsp;<span class="date">{{m[3]}}</span></p>
        {% endfor %}
    </div>

{% endblock %}
