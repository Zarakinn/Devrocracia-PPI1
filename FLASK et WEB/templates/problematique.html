{% extends 'header_layout.html' %}
{%block css%}<link rel="stylesheet" href="../static/QuestionSolution.css">{%endblock%}

{% block header %}

    <h1>{{prob[2]}}</h1>
    {% for i in range(0,len_question-incr_etat) %}

    <div class="tablo-question-solution">
        <button id="{{choosen_question[i][0]}}" class="question-button" onclick="show_hide(this.id,'{{choosen_solution[i][0]}}')">{{choosen_question[i][2]}}</button>
        <button id="{{choosen_solution[i][0]}}" title="{{choosen_solution[i][3]}}"class="solution-button" onclick="show_hide(this.id,'{{choosen_question[i][0]}}')">{{choosen_solution[i][2]}}</button>
    </div>


    <div id="{{'-'+choosen_question[i][0]}}" class="tablo-gagnants-perdants">
        {%if i!=0%}
        {%for j in every_question[i]%}
            {% if j[2]==choosen_question[i][2] %}
                <p class="choix-gagnant">{{j[2]}}&nbsp;{{j[5]}}%</p> 
            {% else %}
                <p class="choix-perdant">{{j[2]}}&nbsp;{{j[5]}}%</p>
            {% endif %}
        {%endfor%}
        {%endif%}
    </div>

    
    <div id="{{'-'+choosen_solution[i][0]}}" class="tablo-gagnants-perdants">
        {%for j in every_solution[i]%}
            {% if j[2]==choosen_solution[i][2] %}
                <p class="choix-gagnant" title="{{j[3]}}">{{j[2]}}&nbsp;{{j[5]}}%</p>
            {% else %}
                <p class="choix-perdant" title="{{j[3]}}">{{j[2]}}&nbsp;{{j[5]}}%</p>
            {% endif %}
        {%endfor%}
    </div>
   
    {% endfor %}

    
    <script>
        function show_hide(button_id,other_button_id) //cette fonction change le display css du bouton cliqué de grid à none (ça affiche ou non), si un autre grid est deja affiché elle le desactive au passage.
        {
            var Button = document.getElementById("-"+button_id);
            var OtherButton = document.getElementById("-"+other_button_id);

            if(Button.style.display === "grid")
                {
                    Button.style.display = "none";
                }
            else
                {
                    OtherButton.style.display = "none";
                    Button.style.display = "grid";
                }
        }
    </script>
  

    <div class="tablo-question-solution">
        <button class="question-button-only">{{last_question[2]}}</button> <!--il faut un moyen de savoir si on est dans un cas : vote de question ou vote de solution-->
    </div>

    <h2>{{message_vote}}</h2>

    {% if session.mail %}
        <div class="tablo-choix">
            {% for j in possible_solutions %}
                {% if j[0]==voted_solution %}
                    <a class="choisi" title="{{j[3]}}" href="/problematique/{{prob[0]}}?id={{j[0]}}">{{j[2]}}</a> <!--là y'a une erreur à fix-->
                {% else %}
                    <a class="choix" title="{{j[3]}}" href="/problematique/{{prob[0]}}?id={{j[0]}}">{{j[2]}}</a>
                {% endif %}
            {%endfor%}




    {% if showform %}
        {% if session.mail %}
            <a class="choix" href="/problematique/{{prob[0]}}">+</a>
            <form class="form_new_pb" method ="POST">
                <input autocomplete="off" autofocus name="new_prop_title" placeholder="nom de la nouvelle proposition" type="text">
                <input autocomplete="off" name="new_prop_desc" placeholder="description de la proposition" type="text">
                <input type="submit" value="Soumettre">
            </form>
        {% else %}
            <a class="tronc">+</a>
            <p> Tu dois te connecter pour ajouter une Problématiques</p>
        {% endif %}
    {% elif not(etat=="backtracking") %}
        <a class="choix" tittle="Ajoute une proposition" href="/problematique/{{prob[0]}}?showform=True">+</a>
    {% endif %}




            
        </div>

        <a href="/problematique/{{prob[0]}}?cloture=True"><br />Cloture des votes (expérimental)</a>

    {%else %}
        <div class="tablo-choix">
            {% for j in possible_solutions%}
                <a class="choix">{{j[2]}}</a>
            {%endfor%}
        </div>

        <h2>Connecte-toi pour ajouter des solutions, envoyer des messages ou voter</h2>
    {% endif %}

    
    {% if session.mail %}
    <form class="form_new_msg" method ="POST">
        <input class="message" autocomplete="off" name="message" placeholder="Message à envoyer" type="text">
        <input class="submit" type="submit" value="Envoyer">
    </form>
    {% endif %}

    <div class="chatbox">
        {% for m in messages %}
        <p class="chat"><span class="mail">{{m[2]}}:&nbsp;</span>{{m[1]}}&nbsp;&nbsp;&nbsp;&nbsp;<span class="date">{{m[4]}}</span></p>
        {% endfor %}
    </div>

{% endblock %}
